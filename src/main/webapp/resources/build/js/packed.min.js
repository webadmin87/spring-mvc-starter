!function(e){e.module("springMvcStarter",["ngResource","ui.router","ui.bootstrap","ui.grid","ui.grid.pagination","textAngular","angularFileUpload","pascalprecht.translate","ngMessages"]).constant("urlMapping",{}).constant("uploaderParams",{url:"/admin/upload/"}).constant("urlUploaderParams",{url:"/admin/upload-by-url/"}).config(["$resourceProvider",function(e){e.defaults.stripTrailingSlashes=!1}]).run(["$rootScope","userService","$state",function(e,t,r){e.$on("$stateChangeStart",function(n,i,o){return e.stateChangeBypass?void(e.stateChangeBypass=!1):void(i.data&&i.data.roles&&(n.preventDefault(),t.isAuth()&&t.hasRole(i.data.roles)?(e.stateChangeBypass=!0,r.go(i,o)):(e.stateChangeBypass=!1,alert("Forbidden 403"))))})}]).config(["$provide","$httpProvider",function(e,t){t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",t.defaults.headers.common.Accept="*",t.defaults.cache=!1,e.factory("AppHttpInterceptor",["$q","$location","authStorage",function(e,t,r){return{request:function(e){var t=r.getUser();return t&&(e.headers["X-AUTH-TOKEN"]=t.token),e},responseError:function(n){return 401==n.status?(r.reset(),t.path("/login")):404==n.status&&t.path("/not-found"),e.reject(n)}}}]),t.interceptors.push("AppHttpInterceptor")}]).config(["$sceProvider",function(e){e.enabled(!1)}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("main",{url:"/",templateUrl:"resources/views/index.html",controller:"MainCtrl"}),e.state("login",{url:"/login",templateUrl:"resources/views/login.html",controller:"LoginCtrl"}),e.state("notFound",{url:"/not-found",templateUrl:"resources/views/not-found.html",controller:"NotFoundCtrl"}),e.state("users",{url:"/users",templateUrl:"resources/views/users/users.html",controller:"UserListCtrl",data:{roles:["ROLE_ADMIN"]}}),e.state("users.add",{url:"/add",templateUrl:"resources/views/users/add.html",controller:"UserAddCtrl",data:{roles:["ROLE_ADMIN"]}}),e.state("users.update",{url:"/update/:id",templateUrl:"resources/views/users/update.html",controller:"UserUpdateCtrl",data:{roles:["ROLE_ADMIN"]}})}])}(angular),function(e){function t(){var t="AUTH_STORAGE";this.setUser=function(r){localStorage.setItem(t,e.toJson(r))},this.getUser=function(){return e.fromJson(localStorage.getItem(t))},this.reset=function(){localStorage.removeItem(t)}}e.module("springMvcStarter").service("authStorage",[t])}(angular),function(e,t,r){function n(t){this.getWrapper=function(r){var n=function(t,n,i){var o=this;this.defaultPageSize=20,this.Resource=t,this.paginationOptions={page:1,pageSize:this.defaultPageSize,sortDirection:null,sortField:null},this.gridOptions=e.extend({paginationPageSizes:[this.defaultPageSize,40,80],useExternalPagination:!0,paginationPageSize:this.defaultPageSize,useExternalSorting:!0},n),this.requestParams=i||{},this.gridOptions.onRegisterApi=function(e){o.gridApi=e,e.core.on.sortChanged(r,function(e,t){0==t.length?(o.paginationOptions.sortField=null,o.paginationOptions.sortDirection=null):(o.paginationOptions.sortField=t[0].field,o.paginationOptions.sortDirection=t[0].sort.direction.toUpperCase()),o.loadData()}),e.pagination.on.paginationChanged(r,function(e,t){o.paginationOptions.page=e,o.paginationOptions.pageSize=t,o.loadData()})}};return n.prototype.loadData=function(){var e=this;return this.Resource.query(this.getRequestParams(),function(t,r){e.gridOptions.data=t,e.gridOptions.totalItems=r("X-pagination-total-elements")})},n.prototype.remove=function(e){var r=this;t("Confirm remove?").then(function(t){confirm(t)&&e.$remove(function(){r.loadData()})})},n.prototype.getRequestParams=function(){var t={};for(var r in this.paginationOptions)this.paginationOptions[r]&&(t[r]=this.paginationOptions[r]);return e.extend(t,this.requestParams)},n}}e.module("springMvcStarter").service("gridService",["$translate",n])}(angular,jQuery,_),function(e,t,r){function n(e,r,n,i,o){this.login=function(i){function o(e,t,r){200==t?(n.setUser(e),l.resolve()):l.reject()}function a(){l.reject()}function s(e,r){return t.param(e)}var l=r.defer();return e.post("/login",i,{transformRequest:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(o).error(a),l.promise},this.logout=function(){n.reset(),o.get("$http").removeAll()},this.getUser=function(){return n.getUser()},this.isAuth=function(){return null!=n.getUser()};var a=null;this.getResource=function(){return null==a&&(a=i("/admin/user/:id/",{id:"@id"},{roles:{url:"/admin/user/roles/",method:"GET",isArray:!0}})),a},this.hasRole=function(e){var t=this.getUser();return t?e.indexOf(t.role)>-1:!1}}e.module("springMvcStarter").service("userService",["$http","$q","authStorage","$resource","$cacheFactory",n])}(angular,jQuery,_),function(e,t){function r(e,t,r){t.logout(),e.error,e.model={},e.login=function(n){var i=t.login(n);i.then(function(){r.go("main")},function(){e.error=!0})}}e.module("springMvcStarter").controller("LoginCtrl",["$scope","userService","$state",r])}(angular,_),function(e,t){function r(e){}e.module("springMvcStarter").controller("MainCtrl",["$scope",r])}(angular,_),function(e,t){function r(e){}e.module("springMvcStarter").controller("NotFoundCtrl",["$scope",r])}(angular,_),function(e,t){function r(e,t,r,n){var i=t.getResource();e.roles=i.roles(),e.model=new i({active:!0,filePaths:{},filesToRemove:[],role:"ROLE_ADMIN"}),e.uploaderParams=r,e.save=function(t){var r=function(){n.go("users"),e.gridWrapper.loadData()},i=function(t){e.result=!1,e.errors=t.data};e.model.$save(r,i)},e.update=!1}e.module("springMvcStarter").controller("UserAddCtrl",["$scope","userService","uploaderParams","$state",r])}(angular,_),function(e,t){function r(e,t,r){e.getUser=function(){return t.getUser()},e.logout=function(){t.logout(),r.go("main")},e.isAuth=function(){return t.isAuth()}}e.module("springMvcStarter").controller("UserInfoCtrl",["$scope","userService","$state",r])}(angular,_),function(e,t){function r(e,t,r,n){var i=t.getResource(),o=r.getWrapper(e);n(["Avatar","Username","Email","Actions"]).then(function(t){e.gridWrapper=new o(i,{columnDefs:[{name:"previews",enableSorting:!1,displayName:t.Avatar,cellTemplate:'<div class="ui-grid-cell-contents"><img preview-src="row.entity.previews" height="60" alt="" /></div>'},{name:"id"},{name:"username",displayName:t.Username},{name:"email",displayName:t.Email},{name:"Actions",enableSorting:!1,displayName:t.Actions,cellTemplate:'<div class="ui-grid-cell-contents"><a ui-sref="users.update({id: row.entity.id})" class="glyphicon glyphicon-pencil"></a> <a href="" ng-click="grid.appScope.gridWrapper.remove(row.entity)" class="glyphicon glyphicon-trash"></a></div>'}],rowHeight:60}),e.gridWrapper.loadData()})}e.module("springMvcStarter").controller("UserListCtrl",["$scope","userService","gridService","$translate",r])}(angular,_),function(e,t){function r(e,t,r,n,i){var o=t.getResource();e.roles=o.roles(),e.model=o.get({id:i.id}),e.uploaderParams=r,e.save=function(t){var r=function(){n.go("users"),e.gridWrapper.loadData()},i=function(t){e.result=!1,e.errors=t.data};e.model.$save(r,i)},e.update=!0}e.module("springMvcStarter").controller("UserUpdateCtrl",["$scope","userService","uploaderParams","$state","$stateParams",r])}(angular,_),function(e){e.module("springMvcStarter").directive("emptyToNull",function(){return{restrict:"A",require:"ngModel",priority:10,link:function(e,t,r,n){n.$parsers.push(function(e){return""===e||void 0===e?null:e})}}})}(angular),function(e,t){function r(e,r,n){var i="/resources/build/templates/fileUploadDirective.html";return{restrict:"AE",scope:{model:"=",uploaderParams:"=",urlUploaderParams:"="},controllerAs:"ctrl",controller:function(i,o,a){function s(e){if(e){var t=c.getMaxKey(i.model[a.filesAttr])+1;a.fileDescriptionsAttr&&(i.model[a.fileDescriptionsAttr][t]=""),i.model[a.filesAttr][t]=e}}var l=["filesAttr","removeFilesAttr","uploaderParams","model"];for(var u in l)if(!a[l[u]])throw new Error("Attribute "+u+" can't be empty");i.filesAttr=a.filesAttr,i.model[a.filesAttr]||(i.model[a.filesAttr]={}),i.model[a.removeFilesAttr]||(i.model[a.removeFilesAttr]=[]),i.$watch("model."+a.filesAttr,function(e){if(e){var r=t.keys(e);r=t.reduce(r,function(e,t){return e.push(parseInt(t)),e},[]),r.sort(),i.uploadedFileKeys=r}},!0),a.fileDescriptionsAttr&&(i.descriptions={},i.$watch("model."+a.fileDescriptionsAttr,function(e){if(void 0!==e){if(!e||e.length!=i.model[a.filesAttr].length){var t=i.model[a.fileDescriptionsAttr];i.model[a.fileDescriptionsAttr]={};for(var r in i.model[a.filesAttr])i.model[a.fileDescriptionsAttr][r]=t&&t[r]?t[r]:""}i.descriptions=i.model[a.fileDescriptionsAttr]}})),this.uploader=new e(i.uploaderParams);var c=this;this.uploader.onSuccessItem=function(e,t,r,n){s(t),c.uploader.removeFromQueue(e)},this.uploader.onErrorItem=function(e,t,r,n){console.info("onErrorItem",e,t,r,n)},this.uploader.onBeforeUploadItem=function(e){n.isAuth()&&(e.headers={"X-AUTH-TOKEN":n.getUser().token})},this.deleteFile=function(e,t){var r=e[a.filesAttr][t];a.fileDescriptionsAttr&&delete e[a.fileDescriptionsAttr][t],delete e[a.filesAttr][t],e[a.removeFilesAttr].push(r)},this.baseName=function(e){return e.slice(e.lastIndexOf("/")+1)},this.getMaxKey=function(e){var r=t.keys(e),n=r.length>0?t.max(r,function(e){return parseInt(e)}):0;return parseInt(n)},i.urlUploaderProcess=!1,this.uploadByUrl=function(e){if(i.urlUploaderParams&&e&&!i.urlUploaderProcess){i.urlUploaderProcess=!0;var t=r.post(i.urlUploaderParams.url,"",{params:{url:encodeURI(e)},headers:{"Content-Type":"text/plain",Accept:"*/*"}});t.then(function(){i.urlUploaderProcess=!1}),t.success(function(e){s(e),i.fileUrl=null}),t.error(function(){alert("Upload error!")})}}},templateUrl:i}}e.module("springMvcStarter").directive("fileUpload",["FileUploader","$http","userService",r])}(angular,_),function(e,t,r){"use strict";function n(e){return{require:"?ngModel",restrict:"A",link:function(n,i,o,a){function s(e){var t=u();return c(t)&&c(e)||e===t?(a.$setValidity("match",!0),""===e||e===r?null:e):(a.$setValidity("match",!1),null)}function l(e){return null===e?a.$isEmpty(a.$viewValue)?null:a.$viewValue:e}function u(){var e=d(n);return t.isObject(e)&&e.hasOwnProperty("$viewValue")&&(e=e.$viewValue),e}function c(e){return null===e||e===r||""===e||e===!1}if(!a)return void(console&&console.warn&&console.warn("Match validation requires ngModel to be on the element"));var d=e(o.match),p=e(o.ngModel).assign;n.$watch(u,function(){p(n,s(a.$viewValue))}),a.$parsers.unshift(s),a.$formatters.unshift(l)}}}t.module("springMvcStarter").directive("match",n),n.$inject=["$parse"]}(window,window.angular),function(e){function t(t){var r={support:!(!t.FileReader||!t.CanvasRenderingContext2D),isFile:function(r){return e.isObject(r)&&r instanceof t.File},isImage:function(e){return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(e)},isImageFile:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return this.isImage(t)},isImageUrl:function(e){var t=e.split(".").pop().toLowerCase()+"|";return this.isImage(t)}},n=function(e,t,r){var n=r.width||t.width/t.height*r.height,i=r.height||t.height/t.width*r.width;e.attr({width:n,height:i}),e[0].getContext("2d").drawImage(t,0,0,n,i)};return{restrict:"A",template:'<canvas ng-show="visible" />',link:function(e,t,i){function o(e){var t=new Image;t.onload=a,t.src=e.target.result}function a(){n(l,this,s)}if(r.support){var s=e.$eval(i.ngThumb),l=t.find("canvas");if("string"==typeof s.file){if(!r.isImageUrl(s.file))return;e.visible=!0;var u=new Image;u.src=s.file,u.onload=a}else{if(!r.isFile(s.file))return;if(!r.isImageFile(s.file))return;e.visible=!0;var c=new FileReader;c.onload=o,c.readAsDataURL(s.file)}}}}}e.module("springMvcStarter").directive("ngThumb",["$window",t])}(angular),function(e,t){e.module("springMvcStarter").directive("previewSrc",[function(){return{restrict:"A",scope:{previewSrc:"="},link:function(e,r,n){e.$watch("previewSrc",function(n){if(!n)return void r.hide();var i=t.keys(n);if(i.length>0){i=t.reduce(i,function(e,t){return e.push(parseInt(t)),e},[]),i.sort();var o=e.previewSrc[i[0]];r.attr("src",o),r.show()}else r.attr("src",""),r.hide()},!0)}}}])}(angular,_),function(e){function t(){return{restrict:"A",require:"ngModel",priority:0,link:function(t,r,n,i){i.$formatters.unshift(function(t){return e.isString(t)?new Date(t):t})}}}e.module("springMvcStarter").directive("stringToDate",t)}(angular),function(e){e.module("springMvcStarter").config(["$translateProvider",function(e){e.translations("ru",{Users:"Пользователи","Login error":"Ошибка входа",Username:"Имя пользователя",Password:"Пароль",Login:"Вход","Not found":"404 страница не найдена",Add:"Создать",Save:"Сохранить",Cancel:"Отменить","Error saving":"Ошибка сохранения",Active:"Активность",Fio:"ФИО","Confirm password":"Подтверждение пароля",Avatar:"Аватар",Phone:"Телефон",Text:"Текс",Email:"Электронный адрес",Role:"Роль",Actions:"Действия","Field is required":"Поле обязательно к заполнению","Invalid field value":"Неверное значение поля","Filed to short":"Значение слишком короткое","Field to long":"Значение слишком длинное","Passwords does not match":"Пароли не совпадают","Email incorrect":"Элекстронный адрес введен неверно","Uploaded files":"Загруженные файла","Upload queue":"Очередь загрузки","Upload by url":"Загрузить по URL",Upload:"Загрузить",Name:"Имя",Status:"Статус",Info:"Инфо",Progress:"Прогресс",Remove:"Удалить","Confirm remove?":"Подтвердить удаление?"}),e.preferredLanguage("ru"),e.useSanitizeValueStrategy(null)}])}(angular);