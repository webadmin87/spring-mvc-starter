!function(t){t.module("springMvcStarter",["ngResource","ui.router","ui.bootstrap","ui.grid","ui.grid.pagination"]).constant("urlMapping",{}).config(["$resourceProvider",function(t){t.defaults.stripTrailingSlashes=!1}]).run(["$rootScope","userService","$state",function(t,e,r){t.$on("$stateChangeStart",function(n,o,i){return t.stateChangeBypass?void(t.stateChangeBypass=!1):void(o.data&&o.data.roles&&(n.preventDefault(),e.isAuth()&&e.hasRole(o.data.roles)?(t.stateChangeBypass=!0,r.go(o,i)):(t.stateChangeBypass=!1,alert("Forbidden 403"))))})}]).config(["$provide","$httpProvider",function(t,e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.common.Accept="*",e.defaults.cache=!0,t.factory("AppHttpInterceptor",["$q","$location","authStorage",function(t,e,r){return{request:function(t){var e=r.getUser();return e&&(t.headers["X-AUTH-TOKEN"]=e.token),t},responseError:function(n){return 401==n.status?(r.reset(),e.path("/login")):404==n.status&&e.path("/not-found"),t.reject(n)}}}]),e.interceptors.push("AppHttpInterceptor")}]).config(["$sceProvider",function(t){t.enabled(!1)}]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("main",{url:"/",templateUrl:"resources/views/index.html",controller:"MainCtrl"}),t.state("login",{url:"/login",templateUrl:"resources/views/login.html",controller:"LoginCtrl"}),t.state("notFound",{url:"/not-found",templateUrl:"resources/views/not-found.html",controller:"NotFoundCtrl"}),t.state("users",{url:"/users",templateUrl:"resources/views/users.html",controller:"UserListCtrl",data:{roles:["ROLE_ADMIN"]}})}])}(angular),function(t){function e(){var e="AUTH_STORAGE";this.setUser=function(r){localStorage.setItem(e,t.toJson(r))},this.getUser=function(){return t.fromJson(localStorage.getItem(e))},this.reset=function(){localStorage.removeItem(e)}}t.module("springMvcStarter").service("authStorage",[e])}(angular),function(t,e,r){function n(){this.getWrapper=function(e){var r=function(r,n,o){var i=this;this.defaultPageSize=20,this.Resource=r,this.paginationOptions={page:1,pageSize:this.defaultPageSize,sortDirection:null,sortField:null},this.gridOptions=t.extend({paginationPageSizes:[this.defaultPageSize,40,80],useExternalPagination:!0,paginationPageSize:this.defaultPageSize,useExternalSorting:!0},n),this.requestParams=o||{},this.gridOptions.onRegisterApi=function(t){i.gridApi=t,t.core.on.sortChanged(e,function(t,e){0==e.length?(i.paginationOptions.sortField=null,i.paginationOptions.sortDirection=null):(i.paginationOptions.sortField=e[0].field,i.paginationOptions.sortDirection=e[0].sort.direction.toUpperCase()),i.loadData()}),t.pagination.on.paginationChanged(e,function(t,e){i.paginationOptions.page=t,i.paginationOptions.pageSize=e,i.loadData()})}};return r.prototype.loadData=function(){var t=this;return this.Resource.query(this.getRequestParams(),function(e,r){t.gridOptions.data=e,t.gridOptions.totalItems=r("X-pagination-total-elements")})},r.prototype.getRequestParams=function(){var e={};for(var r in this.paginationOptions)this.paginationOptions[r]&&(e[r]=this.paginationOptions[r]);return t.extend(e,this.requestParams)},r}}t.module("springMvcStarter").service("gridService",[n])}(angular,jQuery,_),function(t,e,r){function n(t,r,n,o,i){this.login=function(o){function i(t,e,r){200==e?(n.setUser(t),u.resolve()):u.reject()}function a(){u.reject()}function s(t,r){return e.param(t)}var u=r.defer();return t.post("/login",o,{transformRequest:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(i).error(a),u.promise},this.logout=function(){n.reset(),i.get("$http").removeAll()},this.getUser=function(){return n.getUser()},this.isAuth=function(){return null!=n.getUser()};var a=null;this.getResource=function(){return null==a&&(a=o("/admin/user/:id",{id:"@id"})),a},this.hasRole=function(t){var e=this.getUser();return e?t.indexOf(e.role)>-1:!1}}t.module("springMvcStarter").service("userService",["$http","$q","authStorage","$resource","$cacheFactory",n])}(angular,jQuery,_),function(t,e){function r(t,e,r){e.logout(),t.error,t.model={},t.login=function(n){var o=e.login(n);o.then(function(){r.go("main")},function(){t.error=!0})}}t.module("springMvcStarter").controller("LoginCtrl",["$scope","userService","$state",r])}(angular,_),function(t,e){function r(t){}t.module("springMvcStarter").controller("MainCtrl",["$scope",r])}(angular,_),function(t,e){function r(t){}t.module("springMvcStarter").controller("NotFoundCtrl",["$scope",r])}(angular,_),function(t,e){function r(t,e,r){t.getUser=function(){return e.getUser()},t.logout=function(){e.logout(),r.go("main")},t.isAuth=function(){return e.isAuth()}}t.module("springMvcStarter").controller("UserInfoCtrl",["$scope","userService","$state",r])}(angular,_),function(t,e){function r(t,e,r){var n=e.getResource(),o=r.getWrapper(t);t.gridWrapper=new o(n,{columnDefs:[{name:"id"},{name:"username"},{name:"email"}]}),t.gridWrapper.loadData()}t.module("springMvcStarter").controller("UserListCtrl",["$scope","userService","gridService",r])}(angular,_);